<!DOCTYPE html>
<html>
<head>
    <style>
        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        td, th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        tr:nth-child(even) {
            background-color: #dddddd;
        }
    </style>
</head>
<body>

<h2>HTML Table Anti Fly-tipping</h2>

<table id="dumpsList">

</table>

<form>
    <input id="dump_longitude" placeholder="Dump longitude">
    <input id="dump_latitude" placeholder="Dump latitude">
    <input id="dump_date" placeholder="Dump date" type="date">
    <button onclick="createDump()">Create dump</button>
</form>

<input id="search_field" type="date">
<button onclick="searchByDate()">Search by Date</button>
<script>
    function searchByDate() {
        var date = document.getElementById("search_field").value;
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (xhttp.readyState === XMLHttpRequest.DONE && xhttp.status === 200) {
                var dumps = JSON.parse(this.responseText);
                fillTable(dumps);
            }
        };
        xhttp.open("GET", "http://localhost:8080/dumps/findDumpByDate?date=" + date, true);
        xhttp.send();
    }

    function deleteDump(dumpId) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (xhttp.readyState === XMLHttpRequest.DONE && xhttp.status === 200) {
                loadDumps();
            }
        };
        xhttp.open("DELETE", "http://localhost:8080/dumps/delete/" + dumpId, true);
        xhttp.send();
    }

    function createDump() {
        var dumpLongitude = document.getElementById("dump_longitude").value;
        var dumpLatitude = document.getElementById("dump_latitude").value;
        var dumpDate = document.getElementById("dump_date").value;

        var xmlhttp = new XMLHttpRequest();   // new HttpRequest instance
        xmlhttp.open("POST", "http://localhost:8080/dumps/save", true);
        xmlhttp.setRequestHeader("Content-Type", "application/json");
        xmlhttp.onreadystatechange = function () {
            if (xhttp.readyState === XMLHttpRequest.DONE && xhttp.status === 200) {
                loadDumps();
            }
        };
        $.getJSON({longitude: dumpLongitude, latitude: dumpLatitude, date: dumpDate});
        xmlhttp.send(JSON.stringify({longitude: dumpLongitude, latitude: dumpLatitude, date: dumpDate}));

    }

    function loadDumps() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (xhttp.readyState === XMLHttpRequest.DONE && xhttp.status === 200) {
                var dumps = JSON.parse(this.responseText);
                fillTable(dumps);
            }
        };
        xhttp.open("GET", "http://localhost:8080/dumps/findAll", true);
        xhttp.send();
    }

    function fillTable(dumps) {
        var html = '<tr>\n' +
            '        <th>Dump id</th>\n' +
            '        <th>Dump longitude</th>\n' +
            '        <th>Dump latitude</th>\n' +
            '        <th>Dump date</th>\n' +
            '        <th>Delete</th>\n' +
            '    </tr>';
        for (var i = 0; i < dumps.length; i++) {
            var dump = dumps[i];
            console.log(dump);
            html = html + '<tr><td>' + dump.id + '</td>\n' +
                '        <td>' + dump.longitude + '</td>\n' +
                '        <td>' + dump.latitude + '</td>\n' +
                '        <td>' + dump.date + '</td>' +
                '        <td><button onclick="deleteDump(' + dump.id + ')">Delete</button></td></tr>';
        }
        document.getElementById("dumpsList").innerHTML = html;
    }

    loadDumps();
</script>
</body>
</html>